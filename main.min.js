var screen_sm = 767;
var screen_md = 991;
var screen_lg = 1199;
$(".blog-post-wrapper img").each(function() {
  if ($(this).width() > 400) {
    $(this).addClass("full")
  } else {
    $(this).addClass("nested")
  }
});

function addThumbnail(a, b) {
  a.find(".billboard-image").css("background-image", 'url("' + b + '")')
}

function fixedNav() {
  if ($(window).width() > screen_md) {
    if (!$("body").hasClass("lp")) {
      $(".site-header").affix({
        offset: {
          top: 0
        }
      });
      $(".choice-site-header").affix({
        offset: {
          top: 0
        }
      })
    }
  } else {
    $(window).off(".affix");
    $(".site-header").removeClass("fixed");
    $(".site-header").removeData("bs.affix").removeClass("affix affix-top affix-bottom");
    $(".choice-site-header").removeClass("fixed");
    $(".choice-site-header").removeData("bs.affix").removeClass("affix affix-top affix-bottom")
  }
}

function wrapBlogPosts() {
  $(".blog-listing-wrapper .post-listing .row-fluid").contents().unwrap();
  var a = $(".blog-listing-wrapper .post-listing").children();
  if ($(window).width() > screen_sm) {
    for (var b = 0; b < a.length; b += 2) {
      a.slice(b, b + 2).wrapAll('<div class="row-fluid"></div>')
    }
  }
}

function equalizeBlogPosts() {
  if ($(window).width() > 767) {
    $(".blog-listing-wrapper .row-fluid").equalize({
      reset: true,
      children: ".post-item"
    })
  } else {
    $(".blog-listing-wrapper .row-fluid .post-item").css("height", "")
  }
}

function megaDropdown() {
  $(".first-nav .hs-menu-depth-1.hs-item-has-children").each(function() {
    if ($(window).width() > screen_md) {
      if ($(this).find(".hs-menu-depth-2").hasClass("hs-item-has-children")) {
        $(this).addClass("mega")
      }
    } else {
      $(".first-nav .hs-menu-depth-1").removeClass("mega")
    }
  });
  $(".mega").each(function() {
    if ($(window).width() > 1400) {
      var a = $(this).width();
      var b = 800;
      var c = b - a;
      var d = c / 2;
      $(this).find("> .hs-menu-children-wrapper").css("left", -(d));
      $(this).find("> .hs-menu-children-wrapper").css("width", b)
    } else {
      $(this).find("> .hs-menu-children-wrapper").css("left", "");
      $(this).find("> .hs-menu-children-wrapper").css("width", "100%")
    }
  })
}
$("#accordion").find(".panel").click(function() {
  var a = $(this).find(".panel-heading").attr("id");
  $(this).parent().find(".panel").removeClass("active");
  $(this).addClass("active");
  if ($(this).find(".panel-collapse").hasClass("in")) {
    $(this).removeClass("active")
  } else {
    setTimeout(function() {
      $("html, body").animate({
        scrollTop: $("#" + a).offset().top - 110
      }, 700, "swing", function() {})
    }, 500)
  }
});
$(".choice-site-header .menu-trigger-container").sidr({
  name: "touch",
  source: " .choice-site-header .second-nav,.choice-site-header .first-nav",
  side: "right"
});
$(".choice-site-header .menu-trigger-container").click(function() {
  $(this).toggleClass("active");
  $(".choice-site-header .menu-trigger").toggleClass("active");
  if ($(window).width() > screen_md) {
    $(".choice-site-header").toggleClass("menu-open")
  }
});
$(".inline-video").each(function(b) {
  var a = $(this).find("form .video-id").val();
  var c = $(this).find(".play-btn");
  var d = "inline-video-" + b;
  $(this).addClass(a);
  d = Wistia.embed(a, {
    autoPlay: false,
    videoFoam: true,
    playButton: false,
    playerColor: "#999999",
    playbar: true
  });
  $(c).click(function() {
    d.play();
    $(this).addClass("disabled")
  });
  d.bind("play", function() {
    $(c).addClass("disabled")
  });
  d.bind("pause", function() {
    $(c).removeClass("disabled")
  })
});
if (!$(".resource-section-container").hasClass("enabled")) {
  $(".resource-section > span > div.hs_cos_wrapper").parent().parent().parent().parent().parent().addClass("enabled")
}
if (!$(".three-column-section").hasClass("enabled")) {
  $(".three-column-section > span > div.hs_cos_wrapper").parent().parent().addClass("enabled")
}
if (!$("body.two-column-right .flex-bottom-fixed").hasClass("enabled")) {
  $(".flex-bottom-fixed > span > div.hs_cos_wrapper").parent().parent().addClass("enabled")
}
$(".resource-section > span > div.hs_cos_wrapper:not:nth-child(even)").each(function() {
  var a = $(this);
  var b = '<div class="clearfix" />';
  $(b).insertAfter(a)
});

function addThumbnail(a, b) {
  a.find("figure").css("background-image", 'url("' + b + '")')
}
if ($(".popover-video").length) {
  $(".popover-video").each(function(c) {
    $(this).attr("id", "vc" + c);
    var d = $("#vc" + c);
    var a = d.find(".video-link");
    var b = a.attr("href");
    $.ajax({
      url: "//fast.wistia.com/oembed/?url=" + encodeURIComponent(b),
      dataType: "jsonp",
      crossDomain: true,
      cache: false,
      success: function(e) {
        $.each(e, function(f, g) {
          if (f === "thumbnail_url") {
            addThumbnail(d, g)
          }
        })
      }
    })
  })
}
$(".resource-section-container.enabled").each(function(a) {
  if (a == 0) {
    $(this).addClass("first")
  }
});
$(window).on("load resize", function() {
  $(".resource-section .popover-video figure,.resource-section .resource-item .photo, .feature-section .feature-photo figure").keepRatio({
    ratio: 5 / 3,
    calculate: "height"
  })
});
$(document).ready(function() {
  fixedNav();
  megaDropdown();
  wrapBlogPosts();
  equalizeBlogPosts();
  $("a.disabled").removeAttr("href");
  $(".blog-listing-wrapper .summary *").attr("style", "");
  $(".second-nav li:last-child > a").addClass("header-cta");
  $(".header-cta").magnificPopup({
    type: "iframe",
    preloader: false,
    showCloseBtn: true,
    mainClass: "blog-subscribe-form mfp-fade"
  });
  $('.blog-subscribe-form form input[type="submit"]').click(function() {
    $("body").addClass("form-submitted");
    window.parent.close()
  });
  if ($("#form-container").length) {
    $("div.fsEmbed").wrap('<div id="external-form-content" />');
    var a = $("#external-form-content").html();
    $("#form-container").append(a);
    $("#external-form-content").remove()
  }
  $(".resource-item.span-full, .resource-feed-container").parent().addClass("full-width");
  $(".resource-feed-container").each(function(c) {
    var b = $(this).attr("id", "resource-feed-container-" + c);
    var d = $(this).find(".max-posts").val();
    console.log("Section #" + c + " max posts: " + d);
    if ($(this).hasClass("limit")) {
      $(this).children().each(function(e) {
        if (e < d) {
          console.log("Loop Index" + e)
        } else {
          $(this).remove()
        }
      })
    }
  });
  $(".resource-feed-container > div:nth-child(even)").each(function() {
    $('<div class="clearfix" />').insertAfter(this)
  });
  if (($(".primary-content-container .widget-type-rich_text div span p").length)) {
    $(".primary-content-container").addClass("enabled")
  } else {
    $(".primary-content-container").removeClass("enabled").addClass("disabled")
  }
});
$(window).on("load", function() {
  fixedNav();
  wrapBlogPosts();
  equalizeBlogPosts();
  megaDropdown();
  $(".site-footer .social").addClass("loaded")
});
$(window).resize(function() {
  fixedNav();
  equalizeBlogPosts();
  wrapBlogPosts();
  megaDropdown();
  $(".subnav").removeClass("open")
});
if (!$("body").hasClass("inpage-editing")) {
  var container = document.querySelector(".testimonials-grid > span");
  var msnry = new Masonry(container, {
    itemSelector: ".hs_cos_wrapper_type_custom_widget"
  });
  if (!$(".testimonials-grid .custom-mod").length) {
    $(".testimonials-grid-container").addClass("disabled")
  }
};
